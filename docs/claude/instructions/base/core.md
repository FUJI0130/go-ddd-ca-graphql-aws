# Claudeプロジェクトインストラクション

## スレッド開始・運用ルール

1. **開始時**:
  - 前スレッドのサマリーファイルを各スレッドの冒頭で添付
  - 最新プロジェクト状況（project-status-aws-migration.md）を確認
  - 既存の基本情報（project-status.md）も必要に応じて参照
  - 今回のスレッドで取り組む作業目標を明確化し、AI側から確認
  - 作業対象のコードに関連するファイルを初期段階で洗い出し、依存関係を明確にする
    - 関連するすべてのファイルパスを列挙
    - ファイル間の依存関係（インポート、インターフェース実装など）を図示
    - 修正対象の各ファイルの役割と責務を説明

2. **進行中**:
  - 各回答の冒頭に「【現状確認】作業内容」の形式で現在のフェーズを記載
  - 作業がひと段落したらAIから自発的にコミット指示を出す
  - テスト実行はプロジェクトのナレッジファイル「graphql-testing-guide.md」と「開発環境セットアップガイド.md」を参照
  - 実装前に関連ファイルとその依存関係をすべて確認し、影響範囲を把握する
    - 実装するコードが他のファイルのどの部分に依存しているか具体的に特定
    - 修正による影響範囲（呼び出し元、実装クラスなど）を明示
  - 他ファイルで定義されている型やインターフェースを再定義せず、適切に参照する
    - インターフェース定義の場所と実装クラスの関係を明確に理解
    - 既存の実装との整合性を確保
    - 同じ機能の重複実装を避ける

3. **問題解決**:
  - 問題やエラーが発生した場合、すぐに解決策を提案するのではなく、まず状況を十分に分析
    - エラーメッセージの完全な内容を確認
    - 関連ファイルの該当箇所のコードを詳細に分析
    - エラーの前後関係や実行環境の情報を収集
  - 複数のペルソナ（開発者、アーキテクト、テスト担当者など）の視点から問題を多角的に分析
    - 開発者視点: コード実装の技術的な問題点
    - アーキテクト視点: 設計原則との整合性
    - テスト担当者視点: テスト可能性と検証方法
    - プロジェクトマネージャー視点: タイムラインとスコープへの影響
  - 考えられる複数の解決策を提示し、それぞれのメリット・デメリットを説明
    - 各解決策の具体的な実装方法
    - メリット/デメリットの定量的・定性的評価
    - 実装の複雑さとリスク評価
  - 最適解を導き出すための議論を行った上で、具体的な対処方法を決定
  - 単純なエラー修正であっても、根本原因の特定と適切な対処を心がける
  - エラーハンドリング方針についてはエラーハンドリング方針ガイドライン.mdを参照すること

4. **終了時**:
  - 作業内容のサマリー作成（AIが提案）
    - 実施した調査内容と判明した事実を詳細に記載
    - ファイル間の依存関係や実装上の課題を明確に説明
    - 実装した修正内容の詳細（変更したファイル、主要な修正箇所、実装した機能）
    - テスト結果や検証結果の具体的な内容
  - 残タスクを明確化
    - 未完了の作業項目を具体的に列挙
    - 各タスクの依存関係と優先順位を明示
  - 次のスレッドへの引継ぎ事項を記録
    - 次のスレッドで必要となる情報（コードの状態、既知の問題点など）
    - 完了待ちのテストや検証項目
  - キリのいいタイミングで、project-status-aws-migration.mdの内容を更新
    コードブロックで修正箇所を個別に出す
  - スレッドの長さが長くなったり、作業の区切りが良いタイミングで次のスレッドへの移行を提案された場合、AI側から自動的に以下を準備：
    1. スレッドサマリー（作業内容、成果、次のステップを含む）
    2. スレッドフロー（議論の流れや重要な決定事項を含む）
    3. 次のスレッドで必要となる作業計画
    上記をそれぞれmdファイルとして個別に提供

## コードベース分析と実装プランニング

1. **ファイル依存関係の明確化**:
   - 実装前に関連するすべてのファイルを特定し、依存関係図を作成する
   - インターフェース定義やタイプ定義のソースファイルを確認
   - パッケージ内の他ファイルで定義された機能を再実装せず、適切に参照する

2. **変更影響範囲の分析**:
   - 修正対象のファイルが影響を与える他のファイルを事前に特定する
   - すべての影響箇所で整合性を保つ実装計画を立てる
   - 必要に応じて統合テストを計画し、システム全体への影響を評価する

3. **段階的な実装とフィードバック**:
   - 大きな変更を小さな単位に分割し、各ステップで検証する
   - 早期にテストを実行し、問題を早期発見する
   - 実装→テスト→調整のサイクルを短く保つ

## スレッドをまたぐ作業の管理

1. **作業の一貫性と分割原則**:
   - 相互依存するファイルの修正は、可能な限り同一スレッド内で完結させる
   - やむを得ずスレッドをまたぐ場合は、論理的に区切れる地点で分割する
   - スレッド分割前に「スレッド間作業分割計画」を作成し、依存関係を明確化する

2. **コード状態の継続性確保**:
   - 未完了コードの取り扱い方法を明確にする
   - 依存関係のマッピングを共有する
   - 作業進捗状況を詳細に記録する

3. **テスト状態の継続性**:
   - 現時点での検証状況を記録する
   - 次スレッドでの検証計画を明確にする

4. **スレッド終了時のサマリー強化**:
   - 通常のサマリーに加え、「コード状態セクション」を追加
   - 「依存関係セクション」で未解決の依存関係を明示
   - 「次スレッド開始手順」で作業再開方法を具体的に指示

5. **次スレッド開始時の手順**:
   - 前スレッドの「スレッド間作業分割計画」を確認
   - 前スレッドの「コード状態セクション」に基づいてコードを再現
   - コード再現後、依存関係が正しく解決されているか確認
   - 作業再開前に現在の状態が前スレッド終了時と一致するか検証

## プロジェクト方針

1. **優先事項**:
  - AWS環境への早期移行を最優先事項とする
  - 最小限のフロントエンド実装（MVP）を並行して進める
  - 認証機能の基本実装を早期に完了させる
  - 「プロジェクト優先順位マトリクス」に従った開発順序で進める

2. **フェーズ計画**:
  - フェーズ1 (Week 1-2): AWS基盤整備と認証機能
  - フェーズ2 (Week 3-4): CI/CDパイプラインとフロントエンド基盤
  - フェーズ3 (Week 5-6): フロントエンド機能拡充
  - フェーズ4 (Week 7-8): 最終調整とドキュメント整備

## コーディング規約

1. **アーキテクチャ**:
  - クリーンアーキテクチャの依存関係を厳守
  - ドメインロジックはentity/valueobjectに集中
  - インフラ詳細はinfrastructure層に隠蔽
  - 環境変数による設定の外部化を徹底

2. **エラーハンドリング**:
  - ドメインエラー型の統一（pkg/errors）
  - レイヤー間のエラー変換を一貫して実施
  - エンドユーザー向けエラーメッセージの標準化

3. **テスト**:
  - テスト実行はMakefileのコマンドを使用
  - テストデータ用IDジェネレーターを適切に活用
  - テスト環境のセットアップ手順を厳守
  - テスト失敗時は実装とテストコードの両面から原因を分析し、最適な修正方法を検討

## ブランチ戦略

1. **命名規則**:
  - feat/xxx: 新機能実装
  - fix/xxx: バグ修正
  - refactor/xxx: リファクタリング
  - docs/xxx: ドキュメントの追加・修正
  - chore/xxx: ビルド設定や開発環境の変更

2. **コミット手順**:
  - スレッド内でどこまで作業するか最初に明示
  - 作業単位が完了したらAIから具体的なコミットコマンドを提案
  - コミットメッセージは接頭辞（feat:, fix:, docs:など）を使用

3. **マージ手順**:
  - マージのタイミングと手順もAIから提案
  - コードブロックでコマンドを具体的に示す

4. **新しいブランチの作成**:
  - 新しい作業を始める際のブランチ作成もAIから提案

## 問題解決

開発中に問題が発生した場合:
1. エラーメッセージの全文をAIに共有
2. 関連するファイルの該当箇所を示す
3. AIは問題を多角的に分析し、複数の解決策を検討
4. 解決策を提案する際は理由と影響を明確に説明
5. 実装とテストの両面から検証し、最適な対応を決定

## ナレッジリファレンス

プロジェクト開発に関連する重要な設計・方針ドキュメント:

1. **プロジェクト状況**: 
  - 「project-status-aws-migration.md」（AWS移行計画と最新状況）
  - 「project-status.md」（基本実装の経緯と状況）

2. **開発環境**: 「開発環境セットアップガイド.md」
3. **テスト**: 「graphql-testing-guide.md」
4. **AWS移行計画**: 「aws-migration-plan.md」
5. **AWS実装計画**: 「aws-implementation-plan.md」
6. **Terraform設計**: 「aws-terraform-design.md」
7. **CI/CD設計**: 「aws-cicd-pipeline.md」
8. **認証実装計画**: 「auth-implementation-plan.md」
9. **フロントエンド仕様**: 「frontend-mvp-specification.md」
10. **優先順位マトリクス**: 「project-prioritization-matrix.md」