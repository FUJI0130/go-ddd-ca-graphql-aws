# インストラクション管理システム使用ガイド

## 概要

このドキュメントでは、Claude APIとの作業効率を向上させるために開発されたインストラクション管理システムの使用方法を説明します。このシステムは、基本指示と作業タイプ別の特化モジュールを組み合わせることで、各作業に最適化されたインストラクションを生成します。

## システム構造

### ディレクトリ構造

```
./instructions/
  ├── base/
  │   └── core.md           # 必須の基本指示
  ├── modules/
  │   ├── aws.md            # AWS関連作業用
  │   ├── backend.md        # バックエンド開発用
  │   ├── frontend.md       # フロントエンド開発用
  │   └── problem_solving.md  # 問題解決用
  ├── combined/             # 自動生成される組み合わせ
  │   ├── aws_instruction.md
  │   ├── backend_instruction.md
  │   └── ...
  ├── templates/            # 特殊用途のテンプレート
  │   ├── thread_summary.md    # スレッドサマリー用
  │   ├── code_state.md        # コード状態共有用
  │   └── aws_state.md         # AWS環境状態報告用
  └── README.md             # 使用方法の説明
```

### モジュールの内容

1. **core.md（基本セクション）**
   - スレッド開始・運用ルール
   - コードベース分析と実装プランニング
   - スレッドをまたぐ作業の管理
   - プロジェクト方針
   - コーディング規約
   - ブランチ戦略
   - 問題解決アプローチ
   - ナレッジリファレンス

2. **作業タイプ別モジュール**
   - **aws.md**: AWS環境構築、コスト管理、セキュリティ考慮事項
   - **backend.md**: バックエンド開発のアーキテクチャ、エラーハンドリング、テスト
   - **frontend.md**: フロントエンド開発、React+TypeScript、UIガイドライン
   - **problem_solving.md**: 問題分析、複数視点からの考察、解決策評価

## 使用方法

### 作業前の準備

**重要**: 新しいスレッドを開始する際や、作業内容が変わる際には、必ず適切なインストラクションを生成してClaudeと共有してください。これにより、Claudeが期待通りの支援を提供できます。

### 基本的な使用フロー

1. 作業内容を確認し、適切なインストラクションタイプを選択
2. インストラクションを生成
3. 生成されたファイルをClaudeとの会話で共有
4. **重要**: インストラクションを共有した後、Claudeに「これらのインストラクションは意図した通りに理解できていますか？」と確認する
5. 作業実施
6. 作業完了時に適切なテンプレートを使用してまとめる

### インストラクション生成コマンド

メインのMakefileから以下のコマンドを使用できます：

```bash
# 基本的なインストラクション生成
make instructions-aws        # AWS関連作業用
make instructions-backend    # バックエンド開発用
make instructions-frontend   # フロントエンド開発用
make instructions-problem    # 問題解決用

# 複合インストラクション生成
make instructions-aws-problem        # AWS問題解決用
make instructions-backend-problem    # バックエンド問題解決用
make instructions-frontend-problem   # フロントエンド問題解決用

# カスタム組み合わせ
make instructions-custom MODULES="aws backend"  # 複数モジュールを組み合わせる場合
```

### テンプレートの活用

作業完了時や状態共有時には、以下のテンプレートを活用してください：

1. **スレッドサマリー**: スレッド終了時に作業内容をまとめる
   ```bash
   cp instructions/templates/thread_summary.md ./スレッドサマリー.md
   # 内容を編集後、次スレッドの冒頭でClaudeと共有
   ```

2. **コード状態共有**: スレッドをまたぐコード実装の状態を共有
   ```bash
   cp instructions/templates/code_state.md ./コード状態.md
   # 内容を編集後、次スレッドの冒頭でClaudeと共有
   ```

3. **AWS環境状態報告**: AWS環境の状態とコスト影響をレポート
   ```bash
   cp instructions/templates/aws_state.md ./AWS環境状態.md
   # 内容を編集後、次スレッドの冒頭でClaudeと共有
   ```

## ベストプラクティス

1. **作業開始時のルーチン**
   - 作業内容を確認し、適切なインストラクションを生成
   - 前スレッドのサマリーを確認（存在する場合）
   - インストラクション共有後に理解確認を行う（「これらのインストラクションは意図した通りに理解できていますか？」）
   - 具体的な作業目標を明確にしてClaudeと共有

2. **インストラクション理解の確認**
   - 新しいスレッドの開始時には必ず確認
   - 特に複雑な作業や重要な決定を伴う場合は確認を徹底
   - Claudeの回答から理解度に不安がある場合は、追加説明や明確化を行う
   - 確認の際、単に「理解できましたか？」と尋ねるだけでなく、「これから○○の作業を進めるという認識で合っていますか？」など具体的な内容に言及するとより効果的

3. **作業中のポイント**
   - 各回答の冒頭に「【現状確認】作業内容」形式で現在のフェーズを明記するようClaudeに依頼
   - 複雑な問題に直面した際は `problem_solving` モジュールを活用

4. **作業終了時のまとめ**
   - スレッドサマリーテンプレートを活用
   - 次のスレッドへの引継ぎ事項を明確に記録
   - AWS作業の場合は環境状態とコスト報告を必ず実施

## モジュールの更新と保守

インストラクションモジュールは、プロジェクトの進行に伴い更新が必要になる場合があります。その際は以下の手順で対応してください：

1. 対象のモジュールファイル（例: `instructions/modules/aws.md`）を編集
2. 変更を保存
3. 対応するインストラクションを再生成（例: `make instructions-aws`）

定期的に（少なくとも月1回）モジュールの内容をレビューし、最新のプロジェクト状況に合わせて更新することをお勧めします。

## トラブルシューティング

- **インストラクションが生成されない**
  - `makefiles` ディレクトリとMakefileが存在するか確認
  - 必要なディレクトリ構造（instructions/base, instructions/modules, instructions/combined）が存在するか確認

- **インストラクションが期待通りに機能しない**
  - モジュール内容が最新かつ正確であるか確認
  - 生成されたインストラクションファイルをClaudeと正しく共有できているか確認
  - インストラクション共有後の理解確認ステップを行ったか確認

- **ヘルプ**
  - `make help` コマンドでMakefileのヘルプを表示
  - `makefiles/README.md` でMakefile構造の詳細を確認